/*!
  * @doclify/javascript v1.1.0
  * (c) 2020 Doclify
  * @license MIT
  */
/*!
  * @doclify/javascript v1.1.0
  * (c) 2020 Doclify
  * @license MIT
  */
import t from"axios";class e{constructor(t){this.config=Object.assign({maxSize:1/0,maxItems:1/0,maxAge:0,getLength:()=>1},t||{}),this.reset()}reset(){this.entries=new Map,this.length=0,this.size=0}get(t){const e=this.entries.get(t);e&&this.config.maxAge&&Date.now()-e.now>this.config.maxAge&&this.delete(t)}}class i{constructor(t){this.client=t,this.lang=void 0,this.perPage=void 0,this.page=void 0,this.q=[],this.withLazy=[],this.order=[]}where(t,e,i){return void 0===i&&(i=e,e="eq"),this.q.push([t,e,i]),this}collection(t){return this.eq("sys.collection",t)}contentType(t){return this.eq("sys.contentType",t)}id(t){return this.eq("sys.id",t)}uid(t){return this.eq("sys.uid",t)}eq(t,e){return this.where(t,e)}not(t,e){return this.where(t,"not",e)}in(t,e){return this.where(t,"in",e)}nin(t,e){return this.where(t,"nin",e)}gt(t,e){return this.where(t,"gt",e)}gte(t,e){return this.where(t,"gte",e)}lt(t,e){return this.where(t,"lt",e)}lte(t,e){return this.where(t,"lte",e)}fulltext(t,e){return this.where(t,"fulltext",e)}match(t,e){return this.where(t,"match",e)}with(t){return this.withLazy.push(t),this}orderBy(t,e){return this.order.push([t,e||"asc"]),this}fetch(t){return this.client.cachedRequest("documents/search",{params:{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,limit:t,lang:this.lang}})}paginated(t,e){return this.client.cachedRequest("documents/paginated",{params:{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,perPage:e,page:t,lang:this.lang}})}first(){return this.client.cachedRequest("documents/single",{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,lang:this.lang})}}export default class{constructor(i){if(!i.repository&&!i.url)throw new TypeError("Repository or URL option is required");if(!i.key)throw new TypeError("API key is required");this.config=Object.assign({repository:null,key:null,cache:!1},i),this.http=t.create({baseURL:this.baseUrl,headers:{"x-api-key":this.config.key}}),this.http.interceptors.response.use(t=>t.data,(function(t){return console.log("err",err.response),Promise.reject(t)}));const r="object"==typeof this.config.cache&&this.config.cache?this.config.cache:{};this.cache=new e({maxAge:"number"==typeof r.maxAge?r.maxAge:30,maxSize:r.maxSize||3145728,maxItems:r.maxItems||1e3,getLength:(t,e)=>(console.log("n",t),2*t+e.length)})}get baseUrl(){return this.config.url||`https://${this.config.repository}.cdn.doclify.io/api/v2`}request(t,e){return this.http.request(t,e)}cachedRequest(t,e={}){if(!this.config.cache)return this.request(t,e);const i=`${t}:${JSON.stringify(e.params)}`,r=this.cache.get(i);if(r instanceof Promise)return r;if(r instanceof Error)return Promise.reject(r);if(void 0!==r)return Promise.resolve(r);const s=this.request(t,e);return this.cache.set(i,s),s.then(t=>(this.cache.set(i,t),t)).catch(t=>{throw this.cache.set(i,t),t})}documents(){return new i(this)}}