/*!
  * @doclify/javascript v2.0.11
  * (c) 2020 Doclify
  * @license MIT
  */
/*!
  * @doclify/javascript v2.0.11
  * (c) 2020 Doclify
  * @license MIT
  */
import e from"axios";class t{constructor(e){this.config=Object.assign({maxSize:1/0,maxLength:1/0,maxAge:0,getSize:()=>1},e||{}),this.entries=new Map,this.size=0,this.newest=this.oldest=void 0}reset(){this.entries.clear(),this.size=0,this.newest=this.oldest=void 0}get length(){return this.entries.size}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);if(t){if(!(t.maxAge&&Date.now()-t.now>1e3*t.maxAge))return t.value;this.delete(t)}}set(e,t,r={}){const i=r.maxAge||this.config.maxAge;if(i&&"number"!=typeof i)throw new TypeError("maxAge must be a number");const n="number"==typeof r.size?r.size:this.config.getSize(t,e);if(n>this.config.maxSize)return this.has(e)&&this.delete(e),!1;let h=this.entries.get(e);return h?(this.size-=h.size,h.update(t,n,i),this.markEntryAsUsed(h)):(h=new s(e,t,n,i),this.entries.set(e,h),this.newest?(this.newest.newer=h,h.older=this.newest):this.oldest=h),this.size+=n,this.newest=h,this.cleanup(),!0}markEntryAsUsed(e){e!==this.newest&&(e.newer&&(e===this.oldest&&(this.oldest=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=void 0,e.older=this.newest,this.newest&&(this.newest.newer=e),this.newest=e)}delete(e){const t=e instanceof s?e:this.entries.get(e);return!!t&&(this.size-=t.size,t.size=0,t.newer=t.older=void 0,this.entries.delete(t.key))}cleanup(){for(;(this.length>this.config.maxLength||this.size>this.config.maxSize)&&this.shift(););}shift(){const e=this.oldest;return!!e&&(this.oldest.newer?(this.oldest=this.oldest.newer,this.oldest.older=void 0):(this.oldest=void 0,this.newest=void 0),this.delete(e),!0)}}class s{constructor(e,t,s,r){this.key=e,this.newer=this.older=null,this.update(t,s,r)}update(e,t,s){this.value=e,this.size=t,this.maxAge=s,this.now=s?Date.now():null}}class r{constructor(e){this.client=e,this.lang=void 0,this.perPage=void 0,this.page=void 0,this.q=[],this.includeQuery=[],this.selectQuery=[],this.orderQuery=[]}where(e,t,s){return void 0===s&&(s=t,t="eq"),this.q.push([e,t,s]),this}collection(e){return this.eq("sys.collection",e)}contentType(e){return this.eq("sys.contentType",e)}id(e){return this.eq("sys.id",e)}uid(e){return this.eq("sys.uid",e)}eq(e,t){return this.where(e,t)}not(e,t){return this.where(e,"not",t)}in(e,t){return this.where(e,"in",t)}nin(e,t){return this.where(e,"nin",t)}gt(e,t){return this.where(e,"gt",t)}gte(e,t){return this.where(e,"gte",t)}lt(e,t){return this.where(e,"lt",t)}lte(e,t){return this.where(e,"lte",t)}fulltext(e,t){return this.where(e,"fulltext",t)}match(e,t){return this.where(e,"match",t)}query(e){if("function"!=typeof e)throw new TypeError("Query parameter must be function.");return e.call(this,this),this}with(e){return this.include(e)}include(...e){return e.length&&Array.isArray(e[0])&&(e=e[0]),this.includeQuery.push(...e),this}select(...e){return e.length&&Array.isArray(e[0])&&(e=e[0]),this.selectQuery.push(...e),this}orderBy(e,t){return this.orderQuery.push([e,t||"asc"]),this}getParams(e={}){return Object.assign({q:JSON.stringify(this.q),include:this.includeQuery.length?JSON.stringify(this.includeQuery):void 0,order:this.orderQuery.length?JSON.stringify(this.orderQuery):void 0,select:this.selectQuery.length?JSON.stringify(this.selectQuery):void 0,lang:this.lang},e)}fetch(e){return this.client.cachedRequest("documents/search",{params:this.getParams({limit:e})})}paginated(e,t){return this.paginate(e,t)}paginate(e,t){return this.client.cachedRequest("documents/paginated",{params:this.getParams({perPage:t,page:e})})}first(){return this.client.cachedRequest("documents/single",{params:this.getParams()})}}class i extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,new.target.prototype),this.info=t}get url(){return this.info.url}get method(){return this.info.method.toUpperCase()}get code(){return`${this.info.code||-1}`}get params(){return this.info.params||{}}get error(){return this.info.error||null}get data(){return this.info.data||{}}toString(){return["Doclify call failed:",`${this.method} ${this.url} ${JSON.stringify(this.params)} -`,this.message,`(code ${this.code})`].join(" ")}static fromError(e){const t={code:e.response?e.response.status:null,url:e.request.url,method:e.request.method,data:e.response?e.response.data:null};return new i(e.message,t)}}function n(e){return JSON.parse(JSON.stringify(e))}export default class{constructor(s){if(!s.repository&&!s.url)throw new TypeError("Repository or URL option is required");if(!s.key)throw new TypeError("API key is required");this.config=Object.assign({repository:null,key:null,cache:!1,timeout:1e4},s),this.http=e.create({baseURL:this.baseUrl,timeout:this.config.timeout,headers:{"x-api-key":this.config.key}}),this.http.interceptors.response.use(e=>e,(function(e){return Promise.reject(e)}));const r="object"==typeof this.config.cache&&this.config.cache?this.config.cache:{};this.cache=new t({maxAge:"number"==typeof r.maxAge?r.maxAge:30,maxSize:r.maxSize||3145728,maxLength:r.maxLength||1e3})}get baseUrl(){return this.config.url||`https://${this.config.repository}.cdn.doclify.io/api/v2`}request(e,t={},s=!1){return this.http.request(e,t).then(e=>s?e:e.data).catch(s=>{const r=s.response&&s.response.data?s.response.data:{},n={url:this.baseUrl+"/"+e,code:s.response?s.response.status:-1,params:t.params||{},method:t.method||"GET",error:r.error||null,data:r},h=r.error?r.error.message:s.message;return Promise.reject(new i(h,n))})}cachedRequest(e,t={}){if(!this.config.cache)return this.request(e,t);const s=`${e}:${JSON.stringify(t.params)}`,r=this.cache.get(s);if(r instanceof Promise)return r.then(e=>n(e.data));if(r instanceof Error)return Promise.reject(r);if(void 0!==r)return Promise.resolve(n(r));t.headers=t.headers||{},t.headers["x-cache"]="1";const i=this.request(e,t,!0);return this.cache.set(s,i,{size:1}),i.then(e=>{const t=Number(e.headers["content-length"])||0;return this.cache.set(s,e.data,{size:t}),n(e.data)}).catch(e=>{throw this.cache.set(s,e),e})}documents(){return new r(this)}}