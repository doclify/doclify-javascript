/*!
  * @doclify/javascript v3.0.5
  * (c) 2022 Doclify
  * @license MIT
  */
/*!
  * @doclify/javascript v3.0.5
  * (c) 2022 Doclify
  * @license MIT
  */
import e from"axios";class t{constructor(e){this.client=e,this.langCode=e.config.lang,this.q=[],this.includeQuery=[],this.selectQuery=[],this.orderQuery=[]}where(e,t,r){return void 0===r&&(r=t,t="eq"),this.q.push([e,t,r]),this}collection(e){return this.eq("sys.collection",e)}contentType(e){return this.eq("sys.contentType",e)}id(e){return this.eq("sys.id",e)}uid(e){return this.eq("sys.uid",e)}eq(e,t){return this.where(e,t)}not(e,t){return this.where(e,"not",t)}in(e,t){return this.where(e,"in",t)}nin(e,t){return this.where(e,"nin",t)}gt(e,t){return this.where(e,"gt",t)}gte(e,t){return this.where(e,"gte",t)}lt(e,t){return this.where(e,"lt",t)}lte(e,t){return this.where(e,"lte",t)}fulltext(e,t){return this.where(e,"fulltext",t)}match(e,t){return this.where(e,"match",t)}query(e){if("function"!=typeof e)throw new TypeError("Query parameter must be function.");return e.call(this,this),this}lang(e){return this.langCode=e,this}with(e){return this.include(e)}include(...e){return e.length&&Array.isArray(e[0])&&(e=e[0]),this.includeQuery.push(...e),this}select(...e){return e.length&&Array.isArray(e[0])&&(e=e[0]),this.selectQuery.push(...e),this}orderBy(e,t){return this.orderQuery.push([e,t||"asc"]),this}getParams(e={}){return Object.assign({q:JSON.stringify(this.q),include:this.includeQuery.length?JSON.stringify(this.includeQuery):void 0,order:this.orderQuery.length?JSON.stringify(this.orderQuery):void 0,select:this.selectQuery.length?JSON.stringify(this.selectQuery):void 0,lang:this.langCode},e)}fetch(e){return this.client.cachedRequest("documents/search",{params:this.getParams({limit:e})})}paginated(e,t){return this.paginate(e,t)}paginate(e,t){return this.client.cachedRequest("documents/paginated",{params:this.getParams({perPage:t,page:e})})}first(){return this.client.cachedRequest("documents/single",{params:this.getParams()})}}class r extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,new.target.prototype),this.info=t}get url(){return this.info.url}get method(){return this.info.method.toUpperCase()}get code(){return`${this.info.code||-1}`}get params(){return this.info.params||{}}get error(){return this.info.error||null}get data(){return this.info.data||{}}toString(){return["Doclify call failed:",`${this.method} ${this.url} ${JSON.stringify(this.params)} -`,this.message,`(code ${this.code})`].join(" ")}static fromError(e){const t={code:e.response?e.response.status:null,url:e.request.url,method:e.request.method,data:e.response?e.response.data:null};return new r(e.message,t)}}const s=/["'&<>]/;function i(e){return JSON.parse(JSON.stringify(e))}function n(e){var t,r=""+e,i=s.exec(r);if(!i)return r;var n="",a=0,o=0;for(a=i.index;a<r.length;a++){switch(r.charCodeAt(a)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==a&&(n+=r.substring(o,a)),o=a+1,n+=t}return o!==a?n+r.substring(o,a):n}const a={html:{doc({content:e}){return this.serializeItems(e)},paragraph({content:e}){return`<p>${this.serializeItems(e)}</p>`},heading({attrs:e,content:t}){return`<h${e.level}>${this.serializeItems(t)}</h${e.level}>`},image:({attrs:e})=>`<p><img src="${e.url}"></p>`,text({text:e,marks:t}){if(!t)return n(e);let r=n(e);return t.forEach(({type:e,attrs:t})=>{if("bold"===e)r=`<strong>${r}</strong>`;else if("italic"===e)r=`<em>${r}</em>`;else if("underline"===e)r=`<span style="text-decoration:underline">${r}</span>`;else if("link"===e){const e=t.target?` target="${t.target}" rel="noopener"`:"";r=`<a href="${t.href}"${e}>${r}</a>`}else"superscript"===e?r=`<sup>${r}</sup>`:"subscript"===e&&(r=`<sub>${r}</sub>`)}),r},bullet_list({content:e}){return`<ul>${this.serializeItems(e)}</ul>`},ordered_list({content:e}){return`<ol>${this.serializeItems(e)}</ol>`},list_item({content:e}){return`<li>${this.serializeItems(e)}</li>`},hard_break:()=>"<br>",table({content:e}){return`<table><tbody>${this.serializeItems(e)}</tbody></table>`},table_row({content:e}){return`<tr>${this.serializeItems(e)}</tr>`},table_header(e){return a.html.table_cell.call(this,e,"th")},table_cell({attrs:e,content:t},r="td"){return`<${r} ${Object.keys(e).map(t=>{let r=e[t];if(r)return Array.isArray(r)&&(r=r.join(",")),`${t}="${r}"`}).filter(e=>e).join(" ")}>${this.serializeItems(t)}</${r}>`}}};class o{constructor(e,t){this.type=e||"html",this.serializers=t||{}}serializeItems(e){return(e||[]).map(e=>this.serialize(e)).join("")}serialize(e){if(!e)return"";let t=this.serializers[e.type];return!t&&a[this.type]&&(t=a[this.type][e.type]),t?t.call(this,e):(console.warn(`[@doclify/javascript] Invalid structuredText type '${e.type}', please try upgrading @doclify/javascript.`),"")}}const h=new o;var u={asHtml:function(e){return h.serialize(e)},Serializer:o},l=Object.freeze({__proto__:null,structuredText:u});class c{constructor(t={}){if(!t.url){if(!t.repository)throw new TypeError("Repository or URL option is required.");if(!t.key&&!t.token)throw new TypeError("API key/token is required.")}t.token=t.token||t.key||null,t.cache&&(this.setCache(t.cache),delete t.cache),this.config=Object.assign({url:null,repository:null,token:null,lang:null,timeout:1e4},t);const r={};this.config.token&&(r.Authorization="Bearer "+this.config.token),this.http=e.create({baseURL:this.baseUrl,timeout:this.config.timeout,headers:r}),this.http.interceptors.response.use(e=>e,(function(e){return Promise.reject(e)})),this.dom=l}get baseUrl(){return this.config.url||`https://${this.config.repository}.cdn.doclify.io/api/v2`}setCache(e){this.cache=e}setLang(e){this.config.lang=e}getCacheKey(e,t){const r=[];return Object.keys(t).sort().forEach(e=>{const s=t[e];null!=s&&r.push(`${e}=${s}`)}),`${e}?${r.join("&")}`}request(e,t={},s=!1){return t.params=t.params||{},this.config.lang&&!t.params.lang&&(t.params.lang=this.config.lang),this.http.request(e,t).then(e=>s?e:e.data).catch(s=>{const i=s.response&&s.response.data?s.response.data:{},n={url:this.baseUrl+"/"+e,code:s.response?s.response.status:-1,params:t.params,method:t.method||"GET",error:i.error||null,data:i},a=i.error?i.error.message:s.message;return Promise.reject(new r(a,n))})}cachedRequest(e,t={}){if(!this.cache)return this.request(e,t);const r=this.getCacheKey(e,t.params||{}),s=this.cache.get(r);if(s instanceof Promise)return s.then(e=>i(e.data));if(s instanceof Error)return Promise.reject(s);if(void 0!==s)return Promise.resolve(i(s));const n=this.request(e,t,!0);return this.cache.set(r,n),n.then(e=>(this.cache.set(r,e.data),i(e.data))).catch(e=>{throw this.cache.set(r,e),e})}documents(){return new t(this)}}c.dom=l;export default c;