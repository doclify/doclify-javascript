/*!
  * @doclify/javascript v3.0.1
  * (c) 2020 Doclify
  * @license MIT
  */
/*!
  * @doclify/javascript v3.0.1
  * (c) 2020 Doclify
  * @license MIT
  */
var t,e;t=this,e=function(t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var e=function(t){this.client=t,this.langCode=t.config.lang,this.q=[],this.includeQuery=[],this.selectQuery=[],this.orderQuery=[]};e.prototype.where=function(t,e,r){return void 0===r&&(r=e,e="eq"),this.q.push([t,e,r]),this},e.prototype.collection=function(t){return this.eq("sys.collection",t)},e.prototype.contentType=function(t){return this.eq("sys.contentType",t)},e.prototype.id=function(t){return this.eq("sys.id",t)},e.prototype.uid=function(t){return this.eq("sys.uid",t)},e.prototype.eq=function(t,e){return this.where(t,e)},e.prototype.not=function(t,e){return this.where(t,"not",e)},e.prototype.in=function(t,e){return this.where(t,"in",e)},e.prototype.nin=function(t,e){return this.where(t,"nin",e)},e.prototype.gt=function(t,e){return this.where(t,"gt",e)},e.prototype.gte=function(t,e){return this.where(t,"gte",e)},e.prototype.lt=function(t,e){return this.where(t,"lt",e)},e.prototype.lte=function(t,e){return this.where(t,"lte",e)},e.prototype.fulltext=function(t,e){return this.where(t,"fulltext",e)},e.prototype.match=function(t,e){return this.where(t,"match",e)},e.prototype.query=function(t){if("function"!=typeof t)throw new TypeError("Query parameter must be function.");return t.call(this,this),this},e.prototype.lang=function(t){return this.langCode=t,this},e.prototype.with=function(t){return this.include(t)},e.prototype.include=function(){for(var t,e=[],r=arguments.length;r--;)e[r]=arguments[r];return e.length&&Array.isArray(e[0])&&(e=e[0]),(t=this.includeQuery).push.apply(t,e),this},e.prototype.select=function(){for(var t,e=[],r=arguments.length;r--;)e[r]=arguments[r];return e.length&&Array.isArray(e[0])&&(e=e[0]),(t=this.selectQuery).push.apply(t,e),this},e.prototype.orderBy=function(t,e){return this.orderQuery.push([t,e||"asc"]),this},e.prototype.getParams=function(t){return void 0===t&&(t={}),Object.assign({q:JSON.stringify(this.q),include:this.includeQuery.length?JSON.stringify(this.includeQuery):void 0,order:this.orderQuery.length?JSON.stringify(this.orderQuery):void 0,select:this.selectQuery.length?JSON.stringify(this.selectQuery):void 0,lang:this.langCode},t)},e.prototype.fetch=function(t){return this.client.cachedRequest("documents/search",{params:this.getParams({limit:t})})},e.prototype.paginated=function(t,e){return this.paginate(t,e)},e.prototype.paginate=function(t,e){return this.client.cachedRequest("documents/paginated",{params:this.getParams({perPage:e,page:t})})},e.prototype.first=function(){return this.client.cachedRequest("documents/single",{params:this.getParams()})};var r=function(t){function e(e,r){t.call(this,e),Object.setPrototypeOf(this,new.target.prototype),this.info=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={url:{configurable:!0},method:{configurable:!0},code:{configurable:!0},params:{configurable:!0},error:{configurable:!0},data:{configurable:!0}};return r.url.get=function(){return this.info.url},r.method.get=function(){return this.info.method.toUpperCase()},r.code.get=function(){return""+(this.info.code||-1)},r.params.get=function(){return this.info.params||{}},r.error.get=function(){return this.info.error||null},r.data.get=function(){return this.info.data||{}},e.prototype.toString=function(){return["Doclify call failed:",this.method+" "+this.url+" "+JSON.stringify(this.params)+" -",this.message,"(code "+this.code+")"].join(" ")},e.fromError=function(t){var r={code:t.response?t.response.status:null,url:t.request.url,method:t.request.method,data:t.response?t.response.data:null};return new e(t.message,r)},Object.defineProperties(e.prototype,r),e}(Error);function n(t){return JSON.parse(JSON.stringify(t))}var o=function(e){if(void 0===e&&(e={}),!e.url){if(!e.repository)throw new TypeError("Repository or URL option is required.");if(!e.key&&!e.token)throw new TypeError("API key/token is required.")}e.token=e.token||e.key||null,e.cache&&(this.setCache(e.cache),delete e.cache),this.config=Object.assign({url:null,repository:null,token:null,lang:null,timeout:1e4},e);var r={};this.config.token&&(r.Authorization="Bearer "+this.config.token),this.http=t.create({baseURL:this.baseUrl,timeout:this.config.timeout,headers:r}),this.http.interceptors.response.use((function(t){return t}),(function(t){return Promise.reject(t)}))},i={baseUrl:{configurable:!0}};return i.baseUrl.get=function(){return this.config.url||"https://"+this.config.repository+".cdn.doclify.io/api/v2"},o.prototype.setCache=function(t){this.cache=t},o.prototype.setLang=function(t){this.config.lang=t},o.prototype.getCacheKey=function(t,e){var r=[];return Object.keys(e).sort().forEach((function(t){r.push(t+"="+e[t])})),t+"?"+r.join("&")},o.prototype.request=function(t,e,n){var o=this;return void 0===e&&(e={}),void 0===n&&(n=!1),e.params=e.params||{},this.config.lang&&!e.params.lang&&(e.params.lang=this.config.lang),this.http.request(t,e).then((function(t){return n?t:t.data})).catch((function(n){var i=n.response&&n.response.data?n.response.data:{},s={url:o.baseUrl+"/"+t,code:n.response?n.response.status:-1,params:e.params,method:e.method||"GET",error:i.error||null,data:i},u=i.error?i.error.message:n.message;return Promise.reject(new r(u,s))}))},o.prototype.cachedRequest=function(t,e){var r=this;if(void 0===e&&(e={}),!this.cache)return this.request(t,e);var o=this.getCacheKey(t,e.params||{}),i=this.cache.get(o);if(i instanceof Promise)return i.then((function(t){return n(t.data)}));if(i instanceof Error)return Promise.reject(i);if(void 0!==i)return Promise.resolve(n(i));var s=this.request(t,e,!0);return this.cache.set(o,s),s.then((function(t){return r.cache.set(o,t.data),n(t.data)})).catch((function(t){throw r.cache.set(o,t),t}))},o.prototype.documents=function(){return new e(this)},Object.defineProperties(o.prototype,i),o},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("axios")):"function"==typeof define&&define.amd?define(["axios"],e):(t=t||self).DoclifyJS=e(t.axios);