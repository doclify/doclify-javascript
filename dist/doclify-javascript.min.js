/*!
  * @doclify/javascript v1.1.0
  * (c) 2020 Doclify
  * @license MIT
  */
/*!
  * @doclify/javascript v1.1.0
  * (c) 2020 Doclify
  * @license MIT
  */
var t,e;t=this,e=function(t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var e=function(t){this.config=Object.assign({maxSize:1/0,maxItems:1/0,maxAge:0,getLength:function(){return 1}},t||{}),this.reset()};e.prototype.reset=function(){this.entries=new Map,this.length=0,this.size=0},e.prototype.get=function(t){var e=this.entries.get(t);e&&this.config.maxAge&&Date.now()-e.now>this.config.maxAge&&this.delete(t)};var i=function(t){this.client=t,this.lang=void 0,this.perPage=void 0,this.page=void 0,this.q=[],this.withLazy=[],this.order=[]};i.prototype.where=function(t,e,i){return void 0===i&&(i=e,e="eq"),this.q.push([t,e,i]),this},i.prototype.collection=function(t){return this.eq("sys.collection",t)},i.prototype.contentType=function(t){return this.eq("sys.contentType",t)},i.prototype.id=function(t){return this.eq("sys.id",t)},i.prototype.uid=function(t){return this.eq("sys.uid",t)},i.prototype.eq=function(t,e){return this.where(t,e)},i.prototype.not=function(t,e){return this.where(t,"not",e)},i.prototype.in=function(t,e){return this.where(t,"in",e)},i.prototype.nin=function(t,e){return this.where(t,"nin",e)},i.prototype.gt=function(t,e){return this.where(t,"gt",e)},i.prototype.gte=function(t,e){return this.where(t,"gte",e)},i.prototype.lt=function(t,e){return this.where(t,"lt",e)},i.prototype.lte=function(t,e){return this.where(t,"lte",e)},i.prototype.fulltext=function(t,e){return this.where(t,"fulltext",e)},i.prototype.match=function(t,e){return this.where(t,"match",e)},i.prototype.with=function(t){return this.withLazy.push(t),this},i.prototype.orderBy=function(t,e){return this.order.push([t,e||"asc"]),this},i.prototype.fetch=function(t){return this.client.cachedRequest("documents/search",{params:{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,limit:t,lang:this.lang}})},i.prototype.paginated=function(t,e){return this.client.cachedRequest("documents/paginated",{params:{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,perPage:e,page:t,lang:this.lang}})},i.prototype.first=function(){return this.client.cachedRequest("documents/single",{q:JSON.stringify(this.q),with:this.withLazy.length?JSON.stringify(this.withLazy):void 0,order:this.order.length?JSON.stringify(this.order):void 0,lang:this.lang})};var r=function(i){if(!i.repository&&!i.url)throw new TypeError("Repository or URL option is required");if(!i.key)throw new TypeError("API key is required");this.config=Object.assign({repository:null,key:null,cache:!1},i),this.http=t.create({baseURL:this.baseUrl,headers:{"x-api-key":this.config.key}}),this.http.interceptors.response.use((function(t){return t.data}),(function(t){return console.log("err",err.response),Promise.reject(t)}));var r="object"==typeof this.config.cache&&this.config.cache?this.config.cache:{};this.cache=new e({maxAge:"number"==typeof r.maxAge?r.maxAge:30,maxSize:r.maxSize||3145728,maxItems:r.maxItems||1e3,getLength:function(t,e){return console.log("n",t),2*t+e.length}})},n={baseUrl:{configurable:!0}};return n.baseUrl.get=function(){return this.config.url||"https://"+this.config.repository+".cdn.doclify.io/api/v2"},r.prototype.request=function(t,e){return this.http.request(t,e)},r.prototype.cachedRequest=function(t,e){var i=this;if(void 0===e&&(e={}),!this.config.cache)return this.request(t,e);var r=t+":"+JSON.stringify(e.params),n=this.cache.get(r);if(n instanceof Promise)return n;if(n instanceof Error)return Promise.reject(n);if(void 0!==n)return Promise.resolve(n);var o=this.request(t,e);return this.cache.set(r,o),o.then((function(t){return i.cache.set(r,t),t})).catch((function(t){throw i.cache.set(r,t),t}))},r.prototype.documents=function(){return new i(this)},Object.defineProperties(r.prototype,n),r},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("axios")):"function"==typeof define&&define.amd?define(["axios"],e):(t=t||self).DoclifyJS=e(t.axios);